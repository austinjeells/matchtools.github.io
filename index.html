<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <!--<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> -->
      <meta http-equiv="content-type" content="text/plain; charset=UTF-8"/>
      <!-- Bootstrap CSS -->
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
  </head>
  <style>
      .bd-example-modal-lg .modal-dialog{
        display: table;
        position: relative;
        margin: 0 auto;
        top: calc(33% - 24px);
      }

      .bd-example-modal-lg .modal-dialog .modal-content{
        background-color: transparent;
        border: none;
      }
  </style>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-info">
        <a class="navbar-brand" href="#">Match List Tool</a>
        <span class="navbar-text">Data retrieved ACGME Sept 2018</span>
        <button class="navbar-toggler bg-navy" type="button" data-toggle="collapse" data-target="#navbarSupportedContent">
           <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <button type="button "class="btn btn-info" onclick="location.reload()">Home</button>
                </li>
                <li class="nav-item">
                    <button type="button" class="btn btn-info"onclick="javascript:xport.toCSV('resultsTable', 'Match List Results')"  href="#">Export to CSV</button>
                </li>
            </ul>
        </div>
    </nav>
    
    <div class="jumbotron" style="padding-top: 20px; padding-bottom: 10px">
        <h1 class="display-4">Couples Match Calculator</h1>
        <p class="lead">My wife and I will be applying to The Match. We have had a lot of difficulty identifying 
                        which specialty programs are near each other. So I created this program to calculate the distance between 
                        programs then filter them by a maximum distance. I hope you find this to be useful.</p>
    </div>
       
    <div class="container-fluid"style="padding-right: 5%; padding-left: 5%">   
      <form onsubmit="sendText(event)">
      <div class="row">
      <div class="col-sm-12 col-md-6">
          <div class="card mb-4">
              <h5 class="card-header">Step 1: Select Specialties</h5>
              <div class="card-body text-center">
                  <select class="custom-select"type="text" name="Spec1DropValue" required/>
                    <option value="" disabled selected>Select Specialty</option>
                    <option value="Allergy and Immunology">Allergy and Immunology</option>
                    <option value="Anesthesiology">Anesthesiology</option>
                    <option value="Colon and Rectal Surgery">Colon and Rectal Surgery</option>
                    <option value="Dermatology">Dermatology</option>
                    <option value="Emergency Medicine">Emergency Medicine</option>
                    <option value="Family Medicine">Family Medicine</option>
                    <option value="Internal Medicine">Internal Medicine</option>
                    <option value="Internal Medicine/Pediatrics">Internal Medicine/Pediatrics</option>
                    <option value="Medical Genetics and Genomics">Medical Genetics and Genomics</option>
                    <option value="Neurological Surgery">Neurological Surgery</option>
                    <option value="Neurology">Neurology</option>
                    <option value="Child Neurology">Neurology, Child</option>
                    <option value="Nuclear Medicine">Nuclear Medicine</option>
                    <option value="Obstetrics and Gynecology">Obstetrics and Gynecology</option>
                    <option value="Ophthalmology">Ophthalmology</option>
                    <option value="Orthopaedic Surgery">Orthopaedic Surgery</option>
                    <option value="Osteopathic Neuromusculoskeletal Medicine">Osteopathic Neuromusculoskeletal Medicine</option>
                    <option value="Otolaryngology">Otolaryngology</option>
                    <option value="Pathology-Anatomic and Clinical">Pathology-Anatomic and Clinical</option>
                    <option value="Pediatrics">Pediatrics</option>
                    <option value="Physical Medicine and Rehabilitation">Physical Medicine and Rehabilitation</option>
                    <option value="Plastic Surgery">Plastic Surgery</option>
                    <option value="Plastic Surgery - Integrated">Plastic Surgery - Integrated</option>
                    <option value="Preventive Medicine">Preventive Medicine</option>
                    <option value="Psychiatry">Psychiatry</option>
                    <option value="Radiation Oncology">Radiation Oncology</option>
                    <option value="Diagnostic Radiology">Radiology, Diagnostic</option>
                    <option value="Interventional Radiology - Integrated">Radiology, Interventional - Integrated</option>
                    <option value="Surgery">Surgery</option>
                    <option value="Thoracic Surgery">Thoracic Surgery</option>
                    <option value="Thoracic Surgery - Integrated">Thoracic Surgery - Integrated</option>
                    <option value="Transitional Year">Transitional Year</option>
                    <option value="Urology">Urology</option>
                    <option value="Vascular Surgery - Integrated">Vascular Surgery - Integrated</option>
                    <option value= "" disabled>Fellowships</option>
                    <option value="Pulmonary Disease and Critical Care">Pulmonary Disease and Critical Care</option>
                  </select>
                  <select class="custom-select"type="text" name="Spec2DropValue" style="margin-top: 20px" required/>
                    <option value="" disabled selected>Select Specialty</option>
                    <option value="Allergy and Immunology">Allergy and Immunology</option>
                    <option value="Anesthesiology">Anesthesiology</option>
                    <option value="Colon and Rectal Surgery">Colon and Rectal Surgery</option>
                    <option value="Dermatology">Dermatology</option>
                    <option value="Emergency Medicine">Emergency Medicine</option>
                    <option value="Family Medicine">Family Medicine</option>
                    <option value="Internal Medicine">Internal Medicine</option>
                    <option value="Internal Medicine/Pediatrics">Internal Medicine/Pediatrics</option>
                    <option value="Medical Genetics and Genomics">Medical Genetics and Genomics</option>
                    <option value="Neurological Surgery">Neurological Surgery</option>
                    <option value="Neurology">Neurology</option>
                    <option value="Child Neurology">Neurology, Child</option>
                    <option value="Nuclear Medicine">Nuclear Medicine</option>
                    <option value="Obstetrics and Gynecology">Obstetrics and Gynecology</option>
                    <option value="Ophthalmology">Ophthalmology</option>
                    <option value="Orthopaedic Surgery">Orthopaedic Surgery</option>
                    <option value="Osteopathic Neuromusculoskeletal Medicine">Osteopathic Neuromusculoskeletal Medicine</option>
                    <option value="Otolaryngology">Otolaryngology</option>
                    <option value="Pathology-Anatomic and Clinical">Pathology-Anatomic and Clinical</option>
                    <option value="Pediatrics">Pediatrics</option>
                    <option value="Physical Medicine and Rehabilitation">Physical Medicine and Rehabilitation</option>
                    <option value="Plastic Surgery">Plastic Surgery</option>
                    <option value="Plastic Surgery - Integrated">Plastic Surgery - Integrated</option>
                    <option value="Preventive Medicine">Preventive Medicine</option>
                    <option value="Psychiatry">Psychiatry</option>
                    <option value="Radiation Oncology">Radiation Oncology</option>
                    <option value="Diagnostic Radiology">Radiology, Diagnostic</option>
                    <option value="Interventional Radiology - Integrated">Radiology, Interventional - Integrated</option>
                    <option value="Surgery">Surgery</option>
                    <option value="Thoracic Surgery">Thoracic Surgery</option>
                    <option value="Thoracic Surgery - Integrated">Thoracic Surgery - Integrated</option>
                    <option value="Transitional Year">Transitional Year</option>
                    <option value="Urology">Urology</option>
                    <option value="Vascular Surgery - Integrated">Vascular Surgery - Integrated</option>
                    <option value= "" disabled>Fellowships</option>
                    <option value="Pulmonary Disease and Critical Care">Pulmonary Disease and Critical Care</option>
                  </select>
              </div>
          </div>
      </div>
      <div class="col-sm-12 col-md-6">
          <div class="card mb-4">
              <h5 class="card-header">Step 2: Select Maximum Distance</h5>
              <div class="card-body text-center">
                  <div><input class="form-control" type="number" name="MaxDist" placeholder="Max Distance (Miles)" required></div>
              </div>
          </div>
      </div>
      <div class="container h-100">
          <div class="row h-100 justify-content-center align-items-center">
             <input class="btn btn-outline-info btn-md mb-4" type="submit" value="Submit"/>
          </div>
      </div>
    </div>
    </form>
    </div>
    <div id="resultsContainer"class="container-fluid mb-4 table-responsive" style="padding-right: 5%; padding-left: 5%"></div>  
    
    <div id = "myModal" class="modal fade bd-example-modal-lg" data-backdrop="static" data-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content" style="width: 48px">
                <span class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></span>
            </div>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script>
      var JSONarr = [
        {
        "id": 1,
        "name": "Allergy and Immunology",
        "specialty": "-",
        "location": "-",
        "latitude": "-",
        "longitude": "-",
        "parent_id": 0
        },
        {
        "id": 2,
        "name": "Anesthesiology",
        "specialty": "-",
        "location": "-",
        "latitude": "-",
        "longitude": "-",
        "parent_id": 0
        },
        {
        "id": 3,
        "name": "Child Neurology",
        "specialty": "-",
        "location": "-",
        "latitude": "-",
        "longitude": "-",
        "parent_id": 0
        },
        {
        "id": 37,
        "name": "Albany Medical Center Program",
        "specialty": "Allergy and Immunology",
        "location": "Albany, NY 12203   ",
        "latitude": 42.6823182,
        "longitude": -73.8477874,
        "parent_id": 1
        },
        {
        "id": 38,
        "name": "Baylor College of Medicine Program",
        "specialty": "Allergy and Immunology",
        "location": "Houston, TX 77030 ",
        "latitude": 29.7050857,
        "longitude": -95.40180869999999,
        "parent_id": 1
        },
        {
        "id": 39,
        "name": "Boston University Medical Center Program",
        "specialty": "Allergy and Immunology",
        "location": "Boston, MA 02118 ",
        "latitude": 42.3377967,
        "longitude": -71.0705763,
        "parent_id": 1
        }
      ]

      // $(document).ready(function(){
      //     $.getJSON("JSONarr",function(data){
      //        console.log('JSON loaded as array!');
      //        console.log(data);

      //        // var JSONdata = [];
      //        // $.each(data,function(key,value){

      //        // });
      //     });

      //     //or use this instead
      //     var JSONarr = JSON.parse($.getJSON("JSONarr.json"))
      // });


      function sendText(e) {
        e.preventDefault();
        $(".modal").modal('show');
        setTimeout(function () {$('.modal').modal('hide')}, 20000);
        
        var data = {
          vSpec1DropValue: e.target['Spec1DropValue'].value, 
          vSpec2DropValue: e.target['Spec2DropValue'].value, 
          vMaxDist: e.target['MaxDist'].value
        }
        //Put in new code for calculating from JSON here
        $.getJSON("JSONarr.json", function(result){
          $.each(result, function(i, field){
            $("div").append(field + " ");
          });
        });


        // google.script.run.withSuccessHandler(function(response) {
        //   console.log(response)}).sendText(data);
        // google.script.run.withSuccessHandler(getFromSpreadsheet).getResults();
      }
      
      
      //function to display data
      function sendDataToTable(calculatedData){  
          if (document.getElementById("resultsTable_wrapper")) {
            document.getElementById("resultsTable_wrapper").remove()}
          var spec1Name = calculatedData[1];
          var spec2Name = calculatedData[2];
          var calculatedData = calculatedData[0];
          
          var table = document.createElement("table");
          table.id = 'resultsTable';
          table.setAttribute("class","table table-striped table-hover table-sm table-bordered");

          document.getElementById("resultsContainer").append(table);
          
          //makes table into a dataTable
          $(document).ready(function() {
            $('#resultsTable').DataTable( {
                data: calculatedData,
                columns: [{ title: spec2Name},{ title: "Location" },{ title: "Distance" },{ title: spec1Name },{ title: "Location" }],
                //paging: false,
                "order": [ 2, 'asc' ],
                "lengthMenu": [ [-1, 25, 50, 100], ["All", 25, 50, 100] ]
            } );
          } );
      }
      
      
      //function to remove old table
      Element.prototype.remove = function() {this.parentElement.removeChild(this)}
      NodeList.prototype.remove = HTMLCollection.prototype.remove = function() {
          for(var i = this.length - 1; i >= 0; i--) {
              if(this[i] && this[i].parentElement) {
                  this[i].parentElement.removeChild(this[i]);
              }
          }
      }      
    </script>
     <script>
          //script to export to csv and xls
            var xport = {
          _fallbacktoCSV: true,  
          toXLS: function(tableId, filename) {   
            this._filename = (typeof filename == 'undefined') ? tableId : filename;
            
            //var ieVersion = this._getMsieVersion();
            //Fallback to CSV for IE & Edge
            if ((this._getMsieVersion() || this._isFirefox()) && this._fallbacktoCSV) {
              return this.toCSV(tableId);
            } else if (this._getMsieVersion() || this._isFirefox()) {
              alert("Not supported browser");
            }
        
            //Other Browser can download xls
            var htmltable = document.getElementById(tableId);
            var html = htmltable.outerHTML;
        
            this._downloadAnchor("data:application/vnd.ms-excel" + encodeURIComponent(html), 'xls'); 
          },
          toCSV: function(tableId, filename) {
            this._filename = (typeof filename === 'undefined') ? tableId : filename;
            // Generate our CSV string from out HTML Table
            var csv = this._tableToCSV(document.getElementById(tableId));
            // Create a CSV Blob
            var blob = new Blob([csv], { type: "text/csv" });
        
            // Determine which approach to take for the download
            if (navigator.msSaveOrOpenBlob) {
              // Works for Internet Explorer and Microsoft Edge
              navigator.msSaveOrOpenBlob(blob, this._filename + ".csv");
            } else {      
              this._downloadAnchor(URL.createObjectURL(blob), 'csv');      
            }
          },
          _getMsieVersion: function() {
            var ua = window.navigator.userAgent;

            var msie = ua.indexOf("MSIE ");
            if (msie > 0) {
              // IE 10 or older => return version number
                return parseInt(ua.substring(msie + 5, ua.indexOf(".", msie)), 10);
            }
        
            var trident = ua.indexOf("Trident/");
            if (trident > 0) {
              // IE 11 => return version number
              var rv = ua.indexOf("rv:");
              return parseInt(ua.substring(rv + 3, ua.indexOf(".", rv)), 10);
            }
        
            var edge = ua.indexOf("Edge/");
            if (edge > 0) {
              // Edge (IE 12+) => return version number
              return parseInt(ua.substring(edge + 5, ua.indexOf(".", edge)), 10);
            }

            // other browser
            return false;
          },
          _isFirefox: function(){
            if (navigator.userAgent.indexOf("Firefox") > 0) {
              return 1;
            }
    
            return 0;
          },
          _downloadAnchor: function(content, ext) {
              var anchor = document.createElement("a");
              anchor.style = "display:none !important";
              anchor.id = "downloadanchor";
              document.body.appendChild(anchor);
        
              // If the [download] attribute is supported, try to use it
              
              if ("download" in anchor) {
                anchor.download = this._filename + "." + ext;
              }
              anchor.href = content;
              anchor.click();
              anchor.remove();
          },
          _tableToCSV: function(table) {
            // We'll be co-opting `slice` to create arrays
            var slice = Array.prototype.slice;

            return slice
              .call(table.rows)
              .map(function(row) {
                return slice
                  .call(row.cells)
                  .map(function(cell) {
                    return '"t"'.replace("t", cell.textContent);
                  })
                  .join(",");
              })
              .join("\r\n");
          }
        };    
    </script>
    <script>
     /*function modal(){
           $('.modal').modal('show');
           setTimeout(function () {
           $('.modal').modal('hide');
           }, 8000);
        }*/
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
          $('#example').DataTable();
        } );
    </script>
  </body>
</html>


